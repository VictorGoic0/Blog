{% extends "base.html" %}
{% block title %}All Posts{% endblock %}
{% block meta_description %}Victor Goico's blog — technical writing, development, and building in public.{% endblock %}
{% block content %}
<h1 class="index-title">Blog</h1>

{# tag filter + all-tags section commented out — re-enable with tag filter in phase 2
{% if all_tags %}
<div class="tag-filter" role="group" aria-label="Filter by tag">
    <span class="tag-filter-label">Filter:</span>
    <div class="tag-filter-buttons">
        <button type="button" class="tag-filter-btn active" data-tag="">All</button>
        {% for tag in all_tags %}
        <button type="button" class="tag-filter-btn" data-tag="{{ tag }}">{{ tag }} ({{ tag_index[tag]|length }})</button>
        {% endfor %}
    </div>
</div>
<section class="all-tags" aria-label="All tags">
    <h2 class="all-tags-title">All tags</h2>
    <ul class="all-tags-list">
        {% for tag in all_tags %}
        <li><a href="/?tag={{ tag | urlencode }}" class="tag">{{ tag }}</a> <span class="tag-count">({{ tag_index[tag]|length }})</span></li>
        {% endfor %}
    </ul>
</section>
{% endif %}
#}

<ul class="post-list">
{% for post in posts %}
    <li class="post-list-item">
        <h2 class="post-list-title"><a href="/{{ post.url }}">{{ post.title }}</a></h2>
        <p class="post-list-meta">
            <time datetime="{{ post.date_iso }}">{{ post.date_display }}</time>
            <span aria-hidden="true"> · </span>
            {{ post.read_time_min }} min read
            {# per-item tag display commented out — re-enable with tag filter in phase 2
            {% if post.tags %}
            <span aria-hidden="true"> · </span>
            {% for tag in post.tags %}<span class="tag">{{ tag }}</span>{% if not loop.last %} {% endif %}{% endfor %}
            {% endif %}
            #}
        </p>
        {% if post.excerpt %}<p class="post-list-excerpt">{{ post.excerpt }}</p>{% endif %}
    </li>
{% endfor %}
</ul>

{# tag filter JS commented out — re-enable with tag filter in phase 2
<script>
(function() {
  var buttons = document.querySelectorAll('.tag-filter-btn');
  var items = document.querySelectorAll('.post-list-item');
  if (!buttons.length || !items.length) return;

  function applyFilter(tag) {
    tag = (tag || '').toLowerCase();
    buttons.forEach(function(b) {
      var bTag = (b.getAttribute('data-tag') || '').toLowerCase();
      b.classList.toggle('active', bTag === tag);
    });
    items.forEach(function(item) {
      var tags = (item.getAttribute('data-tags') || '').toLowerCase().split(/\s+/);
      var show = !tag || tags.indexOf(tag) !== -1;
      item.classList.toggle('hidden', !show);
    });
  }

  // Apply ?tag= from URL on load (e.g. from post tag link)
  var params = new URLSearchParams(window.location.search);
  var initialTag = params.get('tag') || '';
  if (initialTag) applyFilter(initialTag);

  buttons.forEach(function(btn) {
    btn.addEventListener('click', function() {
      applyFilter(this.getAttribute('data-tag'));
    });
  });
})();
</script>
#}
{% endblock %}
